From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Mina Her <minacle@live.com>
Date: Fri, 11 Oct 2024 13:10:35 +0900
Subject: [PATCH 1/2] Replace mp4 with m4v format usage


diff --git a/app/models/media_attachment.rb b/app/models/media_attachment.rb
index 2e60f732b8..ad7ae54021 100644
--- a/app/models/media_attachment.rb
+++ b/app/models/media_attachment.rb
@@ -93,7 +93,7 @@ class MediaAttachment < ApplicationRecord
   }.freeze
 
   VIDEO_FORMAT = {
-    format: 'mp4',
+    format: 'm4v',
     content_type: 'video/mp4',
     vfr_frame_rate_threshold: MAX_VIDEO_FRAME_RATE,
     convert_options: {

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Mina Her <minacle@live.com>
Date: Fri, 11 Oct 2024 13:11:35 +0900
Subject: [PATCH 2/2] Replace mp3 with m4a format usage


diff --git a/app/models/media_attachment.rb b/app/models/media_attachment.rb
index ad7ae54021..18ca0863ad 100644
--- a/app/models/media_attachment.rb
+++ b/app/models/media_attachment.rb
@@ -149,12 +149,14 @@ class MediaAttachment < ApplicationRecord
 
   AUDIO_STYLES = {
     original: {
-      format: 'mp3',
-      content_type: 'audio/mpeg',
+      format: 'm4a',
+      content_type: 'audio/mp4',
       convert_options: {
         output: {
           'loglevel' => 'fatal',
-          'q:a' => 2,
+          'movflags' => 'faststart', # Move metadata to start of file so playback can begin before download finishes
+          'c:a' => 'aac',
+          'b:a' => '256k',
         }.freeze,
       }.freeze,
     }.freeze,
